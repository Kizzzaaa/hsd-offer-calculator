<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HSD Offer Calculator</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#eaf2ff; --card:#ffffff; --ink:#1f2937; --muted:#475569;
      --brand:#1a73e8; --brand-700:#155bb5; --ring: rgba(26,115,232,0.28);
      --soft:#f5f9ff; --border:#d0d8e5; --chip:#e8f0fe; --good:#eafff3; --bad:#ffecec;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--ink); font-family:'Poppins',sans-serif; display:flex; justify-content:center; align-items:flex-start; padding:24px}
    .wrap{display:grid; grid-template-columns: 680px minmax(420px, 1fr); gap:28px; width:100%; max-width:1600px}
    .card{background:var(--card); border-radius:16px; box-shadow:0 12px 30px rgba(16,24,40,.08); padding:22px}
    .calc-header{display:flex; align-items:center; gap:12px; justify-content:center; margin-bottom:10px}
    .logo{height:36px; width:auto; display:block}
    h1{font-size:24px; color:var(--brand); margin:0}
    label{display:block; margin:10px 0 6px; font-weight:600; color:var(--muted)}
    input,select,button{
      font-family:inherit; font-size:16px;
    }
    input,select{
      width:100%; padding:12px 12px; border:1px solid var(--border);
      background:#fff; color:inherit; border-radius:10px; outline:none;
    }
    input:focus,select:focus{border-color:var(--brand); box-shadow:0 0 0 4px var(--ring)}
    .row{display:flex; gap:12px; flex-wrap:wrap}
    .btn{padding:12px 14px; border:none; border-radius:10px; background:var(--brand); color:#fff; font-weight:600; cursor:pointer; transition:.22s}
    .btn:hover{background:var(--brand-700); transform:translateY(-1px)}
    .btn.ghost{background:transparent; color:var(--ink); border:1px solid var(--border)}
    .btn.secondary{background:#94a3b8; color:#0b1020}
    .hint{font-size:13px; opacity:.8}
    .msg{font-size:14px; margin-top:6px}
    .msg.ok{color:#0a7a43}
    .msg.error{color:#b91c1c}
    .section-title{font-weight:700; color:var(--brand); margin:4px 0 8px}
    .result{margin-top:12px; padding:16px; background:var(--soft); border-radius:12px; font-weight:600}
    .pill{display:inline-block; padding:6px 10px; border-radius:999px; font-size:14px}
    .pill.base{background:var(--chip); color:var(--brand)}
    .pill.adj.good{background:var(--good)}
    .pill.adj.bad{background:var(--bad)}
    .renov-block{margin-top:10px}
    .renov-options{display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:8px}
    .renov-options label{display:flex; align-items:center; gap:8px; font-weight:400}
    .toast{position:fixed; bottom:18px; left:50%; transform:translateX(-50%); background:#111827; color:#fff; padding:10px 14px; border-radius:10px; box-shadow:0 6px 20px rgba(0,0,0,.35); z-index:9999}
    .list{display:grid; gap:10px}
    .item{background:var(--chip); border-radius:12px; padding:10px; position:relative}
    .badge{border:1px solid var(--border); border-radius:6px; padding:2px 6px; font-size:12px}
    .del{position:absolute; top:8px; right:8px}
    .toolbar{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:10px}
    @media (max-width: 1100px){ .wrap{grid-template-columns: 1fr} }
  </style>
  <!-- Supabase client (external, allowed by CSP) -->
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- Our app code (external, so CSP-safe). Ensure this file exists in project root or /public. -->
  <script defer src="/app.js"></script>
</head>
<body>
  <div class="wrap">
    <!-- CALCULATOR -->
    <section class="card" id="calcCard">
      <div class="calc-header">
        <img class="logo" src="/hsd-logo.png" alt="HSD Logo" />
        <h1>HSD Offer Calculator</h1>
      </div>

      <!-- Auth -->
      <div id="auth">
        <div class="row">
          <input type="email" id="email" placeholder="Email" autocomplete="username" />
          <input type="password" id="password" placeholder="Password" autocomplete="current-password" />
        </div>
        <div class="row" style="margin-top:8px">
          <button class="btn ghost" id="signup">Create account</button>
          <button class="btn" id="signin">Sign in</button>
          <button class="btn ghost" id="signout">Sign out</button>
        </div>
        <div class="hint" id="who">Not signed in</div>
        <div class="msg" id="authMsg"></div>
      </div>

      <!-- Inputs -->
      <label for="customer">Customer Name</label>
      <input id="customer" type="text" placeholder="e.g. Sarah Smith" />

      <label for="price">Listed Price (Â£)</label>
      <input id="price" type="text" inputmode="numeric" placeholder="e.g. 245,000" />

      <div class="row">
        <div style="flex:1 1 220px">
          <label for="days">Timeframe</label>
          <select id="days">
            <option value="7">7 Days</option>
            <option value="30">30 Days</option>
            <option value="90">90 Days</option>
            <option value="180">180 Days</option>
          </select>
        </div>
      </div>

      <!-- Renovations -->
      <div class="renov-block">
        <div class="section-title">Renovations (optional)</div>
        <div class="row" role="radiogroup">
          <label><input type="radio" name="reno" value="no" checked> No</label>
          <label><input type="radio" name="reno" value="yes"> Yes</label>
        </div>

        <div id="renoTypeWrap" style="display:none; margin-top:8px">
          <label for="ptype">Property Type</label>
          <select id="ptype">
            <option value="">Select property type</option>
            <option value="2 bed flat">2 Bed Flat</option>
            <option value="2 bed terrace">2 Bed Terrace</option>
            <option value="3 bed semi">3 Bed Semi</option>
            <option value="4 bed detached">4 Bed Detached</option>
            <option value="4 bed townhouse">4 Bed Townhouse</option>
            <option value="3 bed end terrace">3 Bed End Terrace</option>
            <option value="3 bed bungalow">3 Bed Bungalow</option>
          </select>
        </div>

        <div class="renov-options" id="renoOptions" style="display:none"></div>
      </div>

      <div class="row" style="margin-top:10px">
        <button class="btn" id="calc">Calculate</button>
        <button class="btn secondary" id="clear">Clear</button>
      </div>

      <div class="result" id="result"></div>

      <div class="row" style="margin-top:10px; align-items:center">
        <button class="btn" id="save">Save Calculation</button>
        <div class="msg" id="saveMsg"></div>
      </div>
    </section>

    <!-- SAVED LIST -->
    <section class="card">
      <div class="toolbar">
        <strong>Saved Calculations</strong>
        <div class="row">
          <input id="search" type="text" placeholder="Search by customer name" />
          <button class="btn ghost" id="clearAll">Clear Saved</button>
        </div>
      </div>
      <div class="list" id="list"></div>
    </section>
  </div>

  <div id="toast" class="toast" style="display:none"></div>
</body>
</html>
